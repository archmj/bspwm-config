# vimrc-configuration

## vim使用技巧
了解vim的内置文档   
```
:h vimtutor
```

命令行
```
提示符 |  含义
-----  | -------
`$`   | 在外部Shell中执行命令
`:`   |  用命令行模式执行一条Ex命令
`/`   | 用命令行模式执行正向查找
`?`   | 用命令行模式执行反向查找
`=`  | 用命令行模式对一个Vim脚本表达式求值

dw删除
命令  | 缓冲区内容
------ | -----
{start}  |  **h**ello world
dw       |  world


`it`选中tag标签内的文本

Vim启动不加载vimrc配置并且禁用vi兼容模式。  
```
vim -u NONE -N
```
查看vim版本及检查功能是否可用。   
```
:version
```

`.`命令可以重复上次的操作。
`dd`命令删除整行。
`f`命令正向查找指定字符，`；`查找下一个,`,`反向查找上一个。
`@:`Ex命令重复执行

### 复合命令
复合命令  | 等效命令
-----|-------
C    | c$
s    | cl
S    |  ^C
L    | ^i
A    |  $a
o    | A<CR>
O    | ko


### 可重复的操作及回退方式
目的   | 操作   | 重复  |回退
------|  -----| ---- |  ------
做出一个修改  | {edit}  | .  | u
查找下一个指定字符  | f{char}/t{char}  | ;  |,
在行内查找上一个指定字符  | F{char}/T{char}  |  ; |  ,
在文档中查找下一处匹配项   | /pattern<CR>   | n | N
在文档中查找上一处匹配项  | ?pattern<CR>   | n  | N
执行替换  |  :s/target/replacement   | &  | u
执行一系列修改  | qx{changes}q   | @x  | u


## Vim插入模式

## 插入模式下的命令
命令  |  用途
----- | -----
Ctrl-h  | 删除前一个字符（同退格）
Ctrl-w  |  删除前一个单词（按空格及标点区分单词的）  
Ctrl-u  | 删除至首行
> 以上命令不仅仅适用于Vim，在命令行及其他一些编辑器也能适用。

## 返回普通模式
命令  | 用途
------| ----
`<ESC>`  | 切换到普通模式
`<Ctrl-[>`  | 切换到普通模式（推荐）
`<Ctrl-o>`  | 临时切换到普通模式(一个命令）

> 通过`Ctrl-o`临时到普通模式用，`zz`重绘屏幕后就自动切换插入模式。


yt, 复制到第一个,号的内容。
`<Ctrl-r>`0 把复制的文本粘贴到光标所在位置
`<Ctrl-r><Ctrl-p> 按原义插入寄存器内的文本并修改任何不必要的缩进。
`<Ctrl-r>=`  表达式计算，例如`<Ctrl-r>=5+6`回车后就能算出11。除法计算需要注意会自动取整舍余。

# 用字符编码插入非常用字符
Vim接收的字符编码包含3位数字。（Asicii码）
`<C-v>065 即输出`A`。  
如果想插入字符编码超过3位数的则可以使用Unicode码。
`<C-v>u{1234}`,比如`<C-u>u6211`，即可以插入`我`。（十六进制）
可以通过`ga`命令反查一个字符的编码。

用数字来插入字符编码比较难记忆，vim可以通过二合字符的方式来插入字符。
`<c-k>?I`即可插入`¿`。


`R`由普通模式进入替换模式。


# Vim普通模式
进入插入模式到返回普通模式为止，期间的操作都会被当成一次修改。适当的通过返回普通模式可以增加修改的粒度，可以对每次撤销有更好的范围。
> 所以在换行的时候,使用普通模式的`o`换行比直接按回车换行有更细的粒度，每次需要撤销时也更好控制。

`db`,删除从光标起始位置到单词开头的内容。
`daw`,删除一个单词。
`bdw`,删除一个单词。
在比较命令之间的是否更优，可以通过是否更有利于重复执行此命令来判断。

## 算数
Ctrl-a ,正向查找并递增数字
Ctrl-x ,正向查找并递减数字
> 此命令会自动查找并跳转到数字处，所以直接修改会比f查找后修改要迅速。
!> 要注意，默认vim会把0开头的数字解释成八进制。通过设置`set nrformats=`来让vim把所有数字都当成十进制。

同时一些操作用重复`daw..`来执行和用次数`3daw`来执行，重复执行粒度会更小。

## 操作符命令
命令  | 用途
--- | -----
c   |  修改
d   | 删除
y   | 复制到寄存器
g～  | 反转大小写
gu  | 转化为小写
gU   | 转化为大写
`>`   | 增加缩进
`<`   | 减小缩进
`=`   | 自动缩进
`！`  | 使用外部程序

dl 删除一个字符
daw 删除一个单词
dap 删除一个段落

Vim的语法有一条额外的规则，当一个操作符命令被连续调用两次时，它会作用于当前行。比如`dd`,`>>`,Gu是一个特殊情况，可以使用`GuGU`,也可以使用`gUU`。


# Vim可视模式
Vim有三种不同的可视模式，分别用于操作字符文本，行文本和块文本。

修改单词。   
`viw` 高亮单词,通过`c`命令修改。
> vim不同于其他编辑器选择后可以直接输入修改，但是Vim可以通过`Ctrl-g`来切换到选择模式，这样就和普通编辑器选择后直接修改一样了。


可视模式
命令 | 用途
--- | ----
v  | 激活面向字符的可视模式
V | 激活面向行的可视模式
`<C-v>`  | 激活面向块的可视模式
gv   |  重选上次的高亮选区
o   | 切换高亮选区的活动端

> 可以在不同的可视模式之间切换。

命令  | 缓冲区内容
--- | ----
{start}  | one  two three
viw      | **one** two three
U        | **ONE**  two three
2w       | ONE  two **three**
U        | ONE  two **THRee**
!> 需要注意，当一条可视模式命令重复执行时，它会影响相同数量的文本。
可视模式下`U`有一个等效的普通模式命令`gU{motion}`,使用该命令对单词操作用，后面就可以通过重复命令执行。
`viwU`和`gUaw`可以完成相同的效果，但是背后的含义却不相同。在做一些重复工作的时候，尽量不要使用可视模式。


## 列可视
在文末同意添加分号。
`<Ctrl-v>G$` 进入列可视模式并选择所有行，然后进入末尾。然后`A；<ESC`即可完成所有文末添加分号的操作.
> 同样适用于行首添加注释。
!> 在列可视中`i`和`a`不起作用这是在列模式中他们有不同的约定。可以通过`I`和`A`在列模式统一添加。



## Vim命令行模式
> 初时，先有ed，ed为ex之父，ex为vi之父， 而vi为Vim之父。
可以通过命令`:h vi-differences`来比较Vim和vi的不同。

在按下`：`键时，Vim会切换到命令行模式。出于历史原因，在命令行模式中执行的命令又被成为Ex命令。

操作缓冲区文本的Ex命令
命令  |  用途
---- | -----
`:[ranke]delete[x]`  |  删除指定范围内的行【到寄存器x中】
`:[range]yank[x]A`  |  复制指定范围的行【到寄存器x中】
`:[line]put[x]A`   | 在指定行后粘贴寄存器x中的内容
`:[range]copy {address}`  |在指定行范围鸟的行拷贝到{address}指定的行之下
`:[range]move {address}`  | 把指定范围内的行移动到{address}指定的行之下
`:[range]join`  | 连接指定范围内的行
`:[range]normal{commands}`  | 对指定范围内的每一行指定普通模式命令{commands}
`:[range]substitute/{pattern}/{string}/flags}`  | 把指定范围内出现{pattern}的地方替换为{string}
:[range]global/{pattern}/[cmd]  |  对指定范围内匹配{pattern}的所有行执行Ex命令{cmd}

> <C-w>和<C-u>,<C-v>和<C-k>，<C-r>{register}d等命令可以在Ex命令中使用。


Ex命令能比普通模式命令更快地完成同样的工作。普通模式一般操作当前字符或当前行，而Ex母婴零可以在任意位置执行。

:print 在命令行下方显示执行行的内容。
如果一条只包含数字的Ex命令，Vim会把数字解析成一个地址并跳转到改数字指定的行上。比如`：1`会调到首行。
`2,5p` 在命令行下方显示第2-5行内容。  
符号`.`代表当前行的地址。  
符号`%`代表当前文件中的所有行。   
另外，可以使用行可视模式选择多行，在按下`:`，这样在命令行上会显示`'<.'>`,其中符号`'<`是代表高亮选区首行的位置标记。`'>`则代表高亮选区的最后一行`。
## 位置偏移
位置偏移在开启Vim配置中以相对行号的非常实用。
`:.,.+3p`,代表将当前行以及当前行偏移3行的选区内容在命令行下方显示。(.+3p可以直接写成+3p也可以）


## Ex命令地址及范围符号
符号   | 地址
---- | -----
1     | 文件的第一行
$    | 文件的最夯一行
0   | 虚拟航，位于未见第一行上方
.    | 光标所在行
`'m`    | 包含位置标记m的行
`'<`    | 高亮选区的起始行
`'>`    | 高亮选区的结束行
`%`     |  整个文件（`:1,$`的简写形式）
> 地0行并真是存在，用在特定场景，比如复制内容当文件开头时。

# 复制移动行
`:copy`命令及简写`:co`或`:t`可以把一行或多行复制到另外区域。`:move`则是移动一行或多行。

## 复制
命令   |  用途
`:6t.`  | 把第6行复制到当前行下方
`:t6`  |  把当前行复制到第6行下方
`:t.`  | 为当前行创建一个副本（类似于普通模式下的yyp）
`t$`  | 把当前行复制到文本结尾
`:'<,'>t0`  把高亮选中的行复制到文件开头

> yyp会使用寄存器而`:t`不会。

`:move`可以简写为`:m`。
其他操作同复制。
重复上一次的Ex命令为`@:`。


# 指定范围内指定普通命令
`:%normal A;` 在所有行后追加分号。


## 自动补全Ex命令
可以通过`<Ctrl-d>`来提示选项，按`<Tab>`选择补全内容(实际Tab可以完成`<Ctrl-d>`的工作)。


## 把当前单词插入命令行
`<C-r><C-w>`会复制光标下的单词并把它插入到命令行中。
`<C-r><C-a>`会复制光标下的字串并把它插入到命令行中。
> 单词会被标点分割，字串不会。

## 历史命令
Vim默认历史记录条数为20条，可以通过配置来提高历史记录。
```
set history=1024
```
> 历史记录会在Vim重启后仍然存在。

## 命令行窗口
通过命令`q:`来调出命令行窗口。

> 命令行窗口始终拥有焦点并且会在活动窗口的上下文中执行，使用分割窗口时需要注意。

当在命令行窗口输入Ex命令时，需要一些修改可以通过`<C-f>`切换到命令行窗口中并会显示之前输入的Ex命令。

命令  |  动作
--- | ------
`q/`  | 打开查找命令历史的命令行窗口
`q:`  | 打开Ex命令历史的命令行窗口
`<Ctrl-f>`  | 从命令行模式切换到命令行窗口


## 运行Shell命令
在Vim的命令模式中，给命令加一个叹号前缀(`!`)，就可以调用外部程序。
> `!ls`和`:ls`，前者是Shell命令，后者是Vim的内置命令。

在Vim的命令行中，符号`%`代表当前文件名。

`:!{cmd}`适用于执行一次性命令。可以通过`:shell`来启动一个交互的shell会话，使用exit命令可以退出此shell并返回vim。

> 在Bash shell中可以通过`Ctrl-z`挂起Vim,通过jobs查看作业列表，用fg命令唤醒一个被挂起的作业。

## 外部命令

命令   | 用途
---- |  -----
`:shell`   | 启动一个shell(输入exit返回Vim）
`:!{cmd}`   | 在shell中执行{cmd}
`:read !{cmd}`  | 在shell中执行{cmd},并把其标准输出插入光标下方
`:[range]write !{cmd} | 在shell中执行{cmd}，以及【range】作为起标准输入
`:[range]!{filter}  | 使用外部程序{filter}过滤执行的[range]

> Vim对make及grep有包装命令


## 批处理Ex命令

除了可以逐条执行命令，还可以把它们存成一个文件。比如example.vim。下次使用的时候通过`:source example.vim`来执行脚本。

> 保存为`.vim`格式可以让Vim显示正确的语法高亮,脚本每行执行一条`Ex`命令，无需加上前缀`:`。

如果有多个文件需要执行脚本，可以一个个遍历这些文件，逐一执行example.vim。

`:args`,查看文件列表。   
`:first`,首个文件。
`:source exmaple.vim` 执行脚本。
`:next` 下个文件
`:source exmaple.vim `执行脚本
...

不过更好的方法是用`:argdo`命令。
```
:argdo source example.vim
```
只需这一条命令，就可以对参数列表里的每个文件执行example.vim中的Ex命令。

> 对一些会再次用到的脚本文件，可以将其纳入版本控制。

